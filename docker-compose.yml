version: '3.8'
networks:
  mzc-final-net:
    driver: bridge
services:
  # [Entry Point & Load Balancer] Apache
  web:
    build:
      context: .
      dockerfile: .docker/web/Dockerfile
    container_name: apache_lb
    restart: always
    ports:
      - "80:80"       # http://127.0.0.1 접속 수신
    volumes:
      - ./Service:/var/www/html/Service
    networks:
      - mzc-final-net
    depends_on:
      - was
  # [Scalable WAS Layer] PHP-FPM
  was:
    build:
      context: .
      dockerfile: .docker/was/Dockerfile
    # 중요: scale을 사용하기 위해 container_name을 삭제합니다.
    restart: always
    networks:
      - mzc-final-net
    volumes:
      - ./Service:/var/www/html/Service
  # [Database] MySQL
  db:
    image: mysql:8.0
    container_name: mysql_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: hackers
      MYSQL_DATABASE: test_db
    networks:
      - mzc-final-net